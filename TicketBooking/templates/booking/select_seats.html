{% extends "base.html" %}
{% block content %}

<div class="container py-4">

  <div class="row justify-content-center">
    <div class="col-md-10">

      <div class="card shadow-lg p-4" style="border-radius: 12px;">

        <h3 class="text-center mb-2">{{ showtime.movie.title }}</h3>
        <p class="text-center text-muted mb-4">
          {{ showtime.date }} â€” {{ showtime.start_time }}
        </p>

        <!-- Legend -->
        <div class="d-flex justify-content-center mb-3">
          <span class="me-3">
            <span class="badge bg-secondary" style="width:20px;height:20px;display:inline-block;"></span>
            Available
          </span>

          <span class="me-3">
            <span class="badge bg-success" style="width:20px;height:20px;display:inline-block;"></span>
            Selected
          </span>

          <span>
            <span class="badge bg-danger" style="width:20px;height:20px;display:inline-block;"></span>
            Booked
          </span>
        </div>

        <hr>

        <!-- Seat Layout -->
        <div class="d-flex flex-column align-items-center">

          <style>
            .seat {
              width: 45px;
              height: 45px;
              background: #e9ecef;
              border-radius: 8px;
              margin: 6px;
              display: inline-flex;
              justify-content: center;
              align-items: center;
              cursor: pointer;
              user-select: none;
              transition: 0.2s;
            }
            .seat:hover {
              background: #d6d6d6;
            }
            .seat.selected {
              background: #198754;
              color: #fff;
              transform: scale(1.08);
            }
            .seat.booked {
              background: #dc3545;
              color: #fff;
              cursor: not-allowed;
            }
          </style>

          <form method="POST" class="w-100 text-center">
            {% csrf_token %}
            <input type="hidden" name="selected_seats" id="selectedSeats">

            {% for row in "ABCDE" %}
              <div class="d-flex justify-content-center">
                {% for num in "123456789" %}
                  {% with seat=row|stringformat:"s"|add:num|stringformat:"s" %}
                    <div class="seat {% if seat in booked_seats %}booked{% endif %}" 
                         data-seat="{{ seat }}">
                      {{ seat }}
                    </div>
                  {% endwith %}
                {% endfor %}
              </div>
            {% endfor %}

            <button class="btn btn-primary mt-4 px-5 py-2" type="submit">
              Continue to Checkout
            </button>
          </form>

        </div>

      </div>

    </div>
  </div>

</div>

<script>
  const seats = document.querySelectorAll(".seat:not(.booked)");
  const selectedField = document.getElementById("selectedSeats");
  let selected = [];

  seats.forEach(seat => {
    seat.addEventListener("click", () => {
      seat.classList.toggle("selected");

      let seatId = seat.dataset.seat;

      if (selected.includes(seatId)) {
        selected = selected.filter(s => s !== seatId);
      } else {
        selected.push(seatId);
      }

      selectedField.value = selected.join(",");
    });
  });
</script>

{% endblock %}
